"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("crlf-normalize"),t=require("string-split-keep2"),r=require("err-code"),n=require("util");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=a(r);function s(e){return e.trim()}function l(e){return null==e}function i(e){return("number"==typeof e||"string"==typeof e)&&/^\d+$/.test(e.toString())}const c=/^([a-z][a-z0-9_]*)(?:(?: \[(\w+)\])?:(?: ([\s\S]*))?)?$/i,u=new RegExp(c.source,c.flags+"m"),f=/^at\s+/,p=/^eval\s+at\s+/,d=/^([ \t]*)(.+)$/;function v(e,t,r){if(!e.endsWith(r))return[e];let n,a=e.length-1,o=1;for(;--a>=0;){const s=e.charAt(a);if(s===r)o++;else if(s===t&&0==--o){n=a;break}}return[e.slice(0,n),e.slice(n+1,-1)].map(s)}function g(e){return!l(e)&&("object"==typeof e&&l(e.line)&&l(e.col)?null:i(e.line)&&i(e.col))}function m(e){const[r,n,a]=t.stringSplitWithLimit(e,":",-3);return null!=a&&a.length&&null!=n&&n.length?{source:r,line:n,col:a}:{source:e}}function x(e){const{indent:t,rawLine:r}=w(e),[n,a]=r.replace(p,"").split(/,\s+/g).map(s),{eval:o,callee:l,calleeNote:i,...c}=h(n);return{evalCallee:l,evalCalleeNote:i,...c,evalTrace:m(a),indent:t}}function w(e){const[,t,r]=d.exec(e);return{indent:t,rawLine:r}}function h(e,t){const{indent:r,rawLine:n}=w(e),a=n.replace(f,"");let[o,s]=v(a,"(",")");s||([o,s]=[s,o]);const l={};if(o){const[e,t]=v(o,"[","]");l.callee=e,l.calleeNote=t}else l.callee=o;return"eval"===l.callee&&(l.eval=!0),!0!==t||n.startsWith("at")?(Object.assign(l,t&&y(s)?x(s):m(s)),!0!==t||$(l)?(l.indent=r,l):{raw:!0,indent:r,rawLine:n}):{raw:!0,indent:r,rawLine:n}}function y(e){return p.test(e)}function $(e){var t;return!N(e)&&(e.eval||i(e.line)||l(e.callee)&&(null===(t=e.source)||void 0===t?void 0:t.length)>0&&g(e))}function S(t,r){var n;let a,o;if(!l(r)){let{type:n,message:s}=T(t,!0),l=M({type:n,message:""===r?s:r});if(0===t.indexOf(l)){let r=t.replace(l,""),n=e.R_CRLF.exec(r);0===(null==n?void 0:n.index)&&(a=e.lineSplit(n.input.replace(n[0],"")),o=l)}}if(null===(n=o)||void 0===n||!n.length){[o,...a]=e.lineSplit(t);const r=a.findIndex((e=>e.trimLeft().startsWith("at")&&$(h(s(e),!0))));o=[o,...a.splice(0,r)].join(e.LF)}return{rawMessage:o,rawTrace:a}}function T(e,t){try{const[,r,n,a]=e.match(t?u:c);return{type:r,code:n,message:a}}catch(t){throw t.message=`Failed to parse error message.\nreason: ${t.message}\nbody=${n.inspect(e)}`,o.default(t,{body:e}),t}}function k(e,t){if("string"!=typeof e)throw o.default(new TypeError("stack must be a string"),{rawStack:e,detectMessage:t});try{const{rawMessage:r,rawTrace:n}=S(e,t),{type:a,code:o,message:s}=T(r);return{type:a,code:o,message:s,traces:n.map((e=>h(e,!0))),rawMessage:r,rawTrace:n,rawStack:e}}catch(r){throw o.default(r,{rawStack:e,detectMessage:t}),r}}function L({callee:e,calleeNote:t,source:r,line:n,col:a}){const o=[r,n,a].filter((e=>void 0!==e)).join(":");return e?`${e}${t?` [${t}]`:""} (${o})`:o}function E({callee:e,evalTrace:t,evalCallee:r,evalCalleeNote:n,...a}){return`${e} (eval at ${L({...a,callee:null!=r?r:"<anonymous>",calleeNote:n})}, ${L(t)})`}function b({type:e,code:t}){return null!=t&&t.length&&(e+=` [${t}]`),`${e}`}function M(e){let t=b(e);var r;return void 0!==e.message&&(t+=`: ${null!==(r=e.message)&&void 0!==r?r:""}`),t}function j(e){var t;return`${null!==(t=e.indent)&&void 0!==t?t:"    "}${e.rawLine}`}function N(e){return!0===e.raw}function C(e){return!0===e.eval}function F(e){var t;return N(e)?j(e):`${null!==(t=e.indent)&&void 0!==t?t:"    "}at ${C(e)?E(e):L(e)}`}class ErrorStack{constructor(e,t){Object.assign(this,k(e,t))}filter(e){return this.traces=this.traces.filter(e),this}format(){return R(this)}}function R(t){var r,n;const a=`${M(t)}`,o=(null!==(r=null===(n=t.traces)||void 0===n?void 0:n.map(F))&&void 0!==r?r:t.rawTrace).join(e.LF);return o?a+e.LF+o:a}function _(e,t){return new ErrorStack(e,t)}exports.ErrorStack=ErrorStack,exports._detectIndent=w,exports.breakBrackets=v,exports.default=_,exports.formatEvalTrace=E,exports.formatMessage=M,exports.formatMessagePrefix=b,exports.formatRawLineTrace=j,exports.formatTrace=L,exports.formatTraceLine=F,exports.formatTraces=function(e){return null==e?void 0:e.map(F)},exports.isEvalSource=y,exports.isEvalTrace=C,exports.isRawLineTrace=N,exports.parseBody=S,exports.parseErrorStack=_,exports.parseEvalSource=x,exports.parseMessage=T,exports.parseSource=m,exports.parseStack=k,exports.parseTrace=h,exports.stringifyErrorStack=R,exports.validPosition=g,exports.validTrace=$;
//# sourceMappingURL=index.cjs.production.min.cjs.map
