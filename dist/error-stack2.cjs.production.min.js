"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("crlf-normalize");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(require("string-split-keep"));function n(e){return e.trim()}const a=/^([a-z][a-z0-9_]*): ([\s\S]*)$/i,s=/^at\s+/,o=/^eval\s+at\s+/;function l(e,t,r){if(!e.endsWith(r))return[e];let a,s=e.length-1,o=1;for(;--s>=0;){const n=e.charAt(s);if(n===r)o++;else if(n===t&&0==--o){a=s;break}}return[e.slice(0,a),e.slice(a+1,-1)].map(n)}function c(e){const[t,n,a]=r.default(e,":",-3);return null!=a&&a.length&&null!=n&&n.length?{source:t,line:n,col:a}:{source:e}}function i(e){const[t,r]=e.replace(o,"").split(/,\s+/g).map(n),{eval:a,callee:s,calleeNote:l,...i}=u(t);return{evalCallee:s,evalCalleeNote:l,...i,evalTrace:c(r)}}function u(e,t){const r=e.replace(s,"");let[n,a]=l(r,"(",")");a||([n,a]=[a,n]);const u={};if(n){const[e,t]=l(n,"[","]");u.callee=e,u.calleeNote=t}else u.callee=n;return"eval"===u.callee&&(u.eval=!0),Object.assign(u,t&&o.test(a)?i(a):c(a)),u}function p(e){return e.eval||"number"==typeof e.line||"string"==typeof e.line&&/^\d+$/.test(e.line)}function f(t){const[r,...a]=e.lineSplit(t),s=a.findIndex((e=>e.trimLeft().startsWith("at")&&p(u(n(e),!0))));return{messageLines:[r,...a.splice(0,s)],rawTrace:a}}function m(e){const[,t,r]=e.match(a);return{type:t,message:r}}function v(e){if("string"!=typeof e)throw new TypeError("stack must be a string");const{messageLines:t,rawTrace:r}=f(e),{type:a,message:s}=m(t.join("\n"));return{type:a,message:s,traces:r.map((e=>u(n(e),!0))),rawStack:e}}function g({callee:e,calleeNote:t,source:r,line:n,col:a}){const s=[r,n,a].filter((e=>void 0!==e)).join(":");return e?`${e}${t?` [${t}]`:""} (${s})`:s}function d({callee:e,evalTrace:t,evalCallee:r,evalCalleeNote:n,...a}){return`${e} (eval at ${g({...a,callee:null!=r?r:"<anonymous>",calleeNote:n})}, ${g(t)})`}function x({type:e,message:t}){return`${e}: ${null!=t?t:""}`}function h(e){return`    at ${e.eval?d(e):g(e)}`}class y{constructor(e){Object.assign(this,v(e))}filter(e){return this.traces=this.traces.filter(e),this}format(){return $(this)}}function $(e){const{type:t,message:r}=e,n=`${x({type:t,message:r})}`,a=e.traces.map(h).join("\n");return a?n+"\n"+a:n}function S(e){return new y(e)}exports.ErrorStack=y,exports.breakBrackets=l,exports.default=S,exports.formatEvalTrace=d,exports.formatLineTrace=h,exports.formatMessage=x,exports.formatTrace=g,exports.parseBody=f,exports.parseErrorStack=S,exports.parseEvalSource=i,exports.parseMessage=m,exports.parseSource=c,exports.parseStack=v,exports.parseTrace=u,exports.stringifyErrorStack=$,exports.validPosition=function(e){var t,r;return(null===(t=e.line)||void 0===t?void 0:t.toString().match(/^\d+$/))&&(null===(r=e.col)||void 0===r?void 0:r.toString().match(/^\d+$/))},exports.validTrace=p;
//# sourceMappingURL=error-stack2.cjs.production.min.js.map
