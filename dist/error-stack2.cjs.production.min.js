"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("crlf-normalize");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(require("string-split-keep"));function n(e){return e.trim()}function a(e){return null==e}function l(e){return("number"==typeof e||"string"==typeof e)&&/^\d+$/.test(e.toString())}const o=/^([a-z][a-z0-9_]*):(?: ([\s\S]*))?$/i,s=/^at\s+/,i=/^eval\s+at\s+/,c=/^([ \t]*)(.+)$/;function u(e,t,r){if(!e.endsWith(r))return[e];let a,l=e.length-1,o=1;for(;--l>=0;){const n=e.charAt(l);if(n===r)o++;else if(n===t&&0==--o){a=l;break}}return[e.slice(0,a),e.slice(a+1,-1)].map(n)}function p(e){return!a(e)&&("object"==typeof e&&a(e.line)&&a(e.col)?null:l(e.line)&&l(e.col))}function f(e){const[t,n,a]=r.default(e,":",-3);return null!=a&&a.length&&null!=n&&n.length?{source:t,line:n,col:a}:{source:e}}function v(e){const{indent:t,rawLine:r}=d(e),[a,l]=r.replace(i,"").split(/,\s+/g).map(n),{eval:o,callee:s,calleeNote:c,...u}=x(a);return{evalCallee:s,evalCalleeNote:c,...u,evalTrace:f(l),indent:t}}function d(e){const[,t,r]=c.exec(e);return{indent:t,rawLine:r}}function x(e,t){const{indent:r,rawLine:n}=d(e),a=n.replace(s,"");let[l,o]=u(a,"(",")");o||([l,o]=[o,l]);const i={};if(l){const[e,t]=u(l,"[","]");i.callee=e,i.calleeNote=t}else i.callee=l;return"eval"===i.callee&&(i.eval=!0),!0!==t||n.startsWith("at")?(Object.assign(i,t&&g(o)?v(o):f(o)),!0!==t||m(i)?(i.indent=r,i):{raw:!0,indent:r,rawLine:n}):{raw:!0,indent:r,rawLine:n}}function g(e){return i.test(e)}function m(e){var t;return!k(e)&&(e.eval||l(e.line)||a(e.callee)&&(null===(t=e.source)||void 0===t?void 0:t.length)>0&&p(e))}function w(t,r){var l;let o,s;if(!a(r)){let{type:n}=y(t),a=S({type:n,message:r});if(0===t.indexOf(a)){let r=t.replace(a,""),n=e.R_CRLF.exec(r);0===(null==n?void 0:n.index)&&(o=e.lineSplit(n.input.replace(n[0],"")),s=a)}}if(null===(l=s)||void 0===l||!l.length){[s,...o]=e.lineSplit(t);const r=o.findIndex((e=>e.trimLeft().startsWith("at")&&m(x(n(e),!0))));s=[s,...o.splice(0,r)].join("\n")}return{rawMessage:s,rawTrace:o}}function y(e){const[,t,r]=e.match(o);return{type:t,message:r}}function $(e,t){if("string"!=typeof e)throw new TypeError("stack must be a string");const{rawMessage:r,rawTrace:n}=w(e,t),{type:a,message:l}=y(r);return{type:a,message:l,traces:n.map((e=>x(e,!0))),rawMessage:r,rawTrace:n,rawStack:e}}function h({callee:e,calleeNote:t,source:r,line:n,col:a}){const l=[r,n,a].filter((e=>void 0!==e)).join(":");return e?`${e}${t?` [${t}]`:""} (${l})`:l}function T({callee:e,evalTrace:t,evalCallee:r,evalCalleeNote:n,...a}){return`${e} (eval at ${h({...a,callee:null!=r?r:"<anonymous>",calleeNote:n})}, ${h(t)})`}function S({type:e,message:t}){return`${e}: ${null!=t?t:""}`}function L(e){var t;return`${null!==(t=e.indent)&&void 0!==t?t:"    "}${e.rawLine}`}function k(e){return!0===e.raw}function b(e){return!0===e.eval}function j(e){var t;return k(e)?L(e):`${null!==(t=e.indent)&&void 0!==t?t:"    "}at ${b(e)?T(e):h(e)}`}class E{constructor(e,t){Object.assign(this,$(e,t))}filter(e){return this.traces=this.traces.filter(e),this}format(){return M(this)}}function M(e){var t,r;const{type:n,message:a}=e,l=`${S({type:n,message:a})}`,o=(null!==(t=null===(r=e.traces)||void 0===r?void 0:r.map(j))&&void 0!==t?t:e.rawTrace).join("\n");return o?l+"\n"+o:l}function N(e,t){return new E(e,t)}exports.ErrorStack=E,exports._detectIndent=d,exports.breakBrackets=u,exports.default=N,exports.formatEvalTrace=T,exports.formatMessage=S,exports.formatRawLineTrace=L,exports.formatTrace=h,exports.formatTraceLine=j,exports.formatTraces=function(e){return null==e?void 0:e.map(j)},exports.isEvalSource=g,exports.isEvalTrace=b,exports.isRawLineTrace=k,exports.parseBody=w,exports.parseErrorStack=N,exports.parseEvalSource=v,exports.parseMessage=y,exports.parseSource=f,exports.parseStack=$,exports.parseTrace=x,exports.stringifyErrorStack=M,exports.validPosition=p,exports.validTrace=m;
//# sourceMappingURL=error-stack2.cjs.production.min.js.map
