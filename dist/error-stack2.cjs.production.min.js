"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("crlf-normalize");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(require("string-split-keep"));function n(e){return e.trim()}function a(e){return null==e}function l(e){return("number"==typeof e||"string"==typeof e)&&/^\d+$/.test(e.toString())}const s=/^([a-z][a-z0-9_]*):(?: ([\s\S]*))?$/i,o=/^at\s+/,i=/^eval\s+at\s+/,c=/^([ \t]*)(.+)$/;function u(e,t,r){if(!e.endsWith(r))return[e];let a,l=e.length-1,s=1;for(;--l>=0;){const n=e.charAt(l);if(n===r)s++;else if(n===t&&0==--s){a=l;break}}return[e.slice(0,a),e.slice(a+1,-1)].map(n)}function p(e){const[t,n,a]=r.default(e,":",-3);return null!=a&&a.length&&null!=n&&n.length?{source:t,line:n,col:a}:{source:e}}function f(e){const{indent:t,line:r}=d(e),[a,l]=r.replace(i,"").split(/,\s+/g).map(n),{eval:s,callee:o,calleeNote:c,...u}=v(a);return{evalCallee:o,evalCalleeNote:c,...u,evalTrace:p(l),indent:t}}function d(e){const[,t,r]=c.exec(e);return{indent:t,line:r}}function v(e,t){const{indent:r,line:n}=d(e),a=n.replace(o,"");let[l,s]=u(a,"(",")");s||([l,s]=[s,l]);const c={};if(l){const[e,t]=u(l,"[","]");c.callee=e,c.calleeNote=t}else c.callee=l;return"eval"===c.callee&&(c.eval=!0),Object.assign(c,t&&i.test(s)?f(s):p(s)),c.indent=r,c}function g(e){return e.eval||"number"==typeof e.line||"string"==typeof e.line&&/^\d+$/.test(e.line)}function m(t,r){var l;let s,o;if(!a(r)){let{type:n}=x(t),a=T({type:n,message:r});if(0===t.indexOf(a)){let r=t.replace(a,""),n=e.R_CRLF.exec(r);0===(null==n?void 0:n.index)&&(s=e.lineSplit(n.input.replace(n[0],"")),o=a)}}if(null===(l=o)||void 0===l||!l.length){[o,...s]=e.lineSplit(t);const r=s.findIndex((e=>e.trimLeft().startsWith("at")&&g(v(n(e),!0))));o=[o,...s.splice(0,r)].join("\n")}return{rawMessage:o,rawTrace:s}}function x(e){const[,t,r]=e.match(s);return{type:t,message:r}}function y(e,t){if("string"!=typeof e)throw new TypeError("stack must be a string");const{rawMessage:r,rawTrace:n}=m(e,t),{type:a,message:l}=x(r);return{type:a,message:l,traces:n.map((e=>v(e,!0))),rawMessage:r,rawTrace:n,rawStack:e}}function $({callee:e,calleeNote:t,source:r,line:n,col:a}){const l=[r,n,a].filter((e=>void 0!==e)).join(":");return e?`${e}${t?` [${t}]`:""} (${l})`:l}function h({callee:e,evalTrace:t,evalCallee:r,evalCalleeNote:n,...a}){return`${e} (eval at ${$({...a,callee:null!=r?r:"<anonymous>",calleeNote:n})}, ${$(t)})`}function T({type:e,message:t}){return`${e}: ${null!=t?t:""}`}function w(e){var t;return`${null!==(t=e.indent)&&void 0!==t?t:"    "}at ${e.eval?h(e):$(e)}`}class S{constructor(e,t){Object.assign(this,y(e,t))}filter(e){return this.traces=this.traces.filter(e),this}format(){return b(this)}}function b(e){var t,r;const{type:n,message:a}=e,l=`${T({type:n,message:a})}`,s=(null!==(t=null===(r=e.traces)||void 0===r?void 0:r.map(w))&&void 0!==t?t:e.rawTrace).join("\n");return s?l+"\n"+s:l}function k(e,t){return new S(e,t)}exports.ErrorStack=S,exports._detectIndent=d,exports.breakBrackets=u,exports.default=k,exports.formatEvalTrace=h,exports.formatLineTrace=w,exports.formatMessage=T,exports.formatTrace=$,exports.parseBody=m,exports.parseErrorStack=k,exports.parseEvalSource=f,exports.parseMessage=x,exports.parseSource=p,exports.parseStack=y,exports.parseTrace=v,exports.stringifyErrorStack=b,exports.validPosition=function(e){return!a(e)&&("object"==typeof e&&a(e.line)&&a(e.col)?null:l(e.line)&&l(e.col))},exports.validTrace=g;
//# sourceMappingURL=error-stack2.cjs.production.min.js.map
