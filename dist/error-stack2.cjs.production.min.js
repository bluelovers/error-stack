"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("crlf-normalize");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(require("string-split-keep"));function n(e){return e.trim()}function s(e){return null==e}function a(e){return("number"==typeof e||"string"==typeof e)&&/^\d+$/.test(e.toString())}const o=/^([a-z][a-z0-9_]*):(?: ([\s\S]*))?$/i,l=/^at\s+/,c=/^eval\s+at\s+/;function i(e,t,r){if(!e.endsWith(r))return[e];let s,a=e.length-1,o=1;for(;--a>=0;){const n=e.charAt(a);if(n===r)o++;else if(n===t&&0==--o){s=a;break}}return[e.slice(0,s),e.slice(s+1,-1)].map(n)}function u(e){const[t,n,s]=r.default(e,":",-3);return null!=s&&s.length&&null!=n&&n.length?{source:t,line:n,col:s}:{source:e}}function p(e){const[t,r]=e.replace(c,"").split(/,\s+/g).map(n),{eval:s,callee:a,calleeNote:o,...l}=f(t);return{evalCallee:a,evalCalleeNote:o,...l,evalTrace:u(r)}}function f(e,t){const r=e.replace(l,"");let[n,s]=i(r,"(",")");s||([n,s]=[s,n]);const a={};if(n){const[e,t]=i(n,"[","]");a.callee=e,a.calleeNote=t}else a.callee=n;return"eval"===a.callee&&(a.eval=!0),Object.assign(a,t&&c.test(s)?p(s):u(s)),a}function m(e){return e.eval||"number"==typeof e.line||"string"==typeof e.line&&/^\d+$/.test(e.line)}function g(t){const[r,...s]=e.lineSplit(t),a=s.findIndex((e=>e.trimLeft().startsWith("at")&&m(f(n(e),!0))));return{messageLines:[r,...s.splice(0,a)],rawTrace:s}}function v(e){const[,t,r]=e.match(o);return{type:t,message:r}}function x(e){if("string"!=typeof e)throw new TypeError("stack must be a string");const{messageLines:t,rawTrace:r}=g(e),{type:s,message:a}=v(t.join("\n"));return{type:s,message:a,traces:r.map((e=>f(n(e),!0))),rawStack:e}}function y({callee:e,calleeNote:t,source:r,line:n,col:s}){const a=[r,n,s].filter((e=>void 0!==e)).join(":");return e?`${e}${t?` [${t}]`:""} (${a})`:a}function d({callee:e,evalTrace:t,evalCallee:r,evalCalleeNote:n,...s}){return`${e} (eval at ${y({...s,callee:null!=r?r:"<anonymous>",calleeNote:n})}, ${y(t)})`}function $({type:e,message:t}){return`${e}: ${null!=t?t:""}`}function h(e){return`    at ${e.eval?d(e):y(e)}`}class b{constructor(e){Object.assign(this,x(e))}filter(e){return this.traces=this.traces.filter(e),this}format(){return k(this)}}function k(e){const{type:t,message:r}=e,n=`${$({type:t,message:r})}`,s=e.traces.map(h).join("\n");return s?n+"\n"+s:n}function S(e){return new b(e)}exports.ErrorStack=b,exports.breakBrackets=i,exports.default=S,exports.formatEvalTrace=d,exports.formatLineTrace=h,exports.formatMessage=$,exports.formatTrace=y,exports.parseBody=g,exports.parseErrorStack=S,exports.parseEvalSource=p,exports.parseMessage=v,exports.parseSource=u,exports.parseStack=x,exports.parseTrace=f,exports.stringifyErrorStack=k,exports.validPosition=function(e){return!s(e)&&("object"==typeof e&&s(e.line)&&s(e.col)?null:a(e.line)&&a(e.col))},exports.validTrace=m;
//# sourceMappingURL=error-stack2.cjs.production.min.js.map
